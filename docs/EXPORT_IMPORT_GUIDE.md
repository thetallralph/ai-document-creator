# Export/Import Feature Documentation

## Overview

The AI Document Creator supports exporting templates as TSX (TypeScript/React) files and importing them back, enabling:
- Sharing templates between users
- Version control of templates
- LLM-generated template integration
- Template customization outside the app

## Export Functionality

### How to Export

1. Open any template in the Document Viewer
2. Click the **"üìÑ Export TSX"** button in the toolbar
3. The template will download as a `.tsx` file

### What Gets Exported

The exported TSX file contains:
- Complete React component code
- All styling (inlined)
- Document structure (pages, layouts)
- Component props (padding, background, etc.)
- Any external dependencies (automatically inlined)

### Export Format

```tsx
// Generated by AI Document Creator
// This template can be imported back into the application
// Edit as needed and ensure it follows the template structure

const Template = () => {
  return (
    <Document title="Your Title" type="flyer" paperSize="A4">
      <Page background="#ffffff" padding="40px">
        {/* Your content here */}
      </Page>
    </Document>
  );
};
```

### Technical Details

- **Static Templates**: Exports the original source code with transformations:
  - Removes import statements (provided by the system)
  - Renames component to `Template` for consistency
  - Inlines any external style dependencies
  
- **Dynamic Templates**: Generates TSX from the component structure:
  - Preserves all properties
  - Maintains proper formatting
  - Includes helpful comments

## Import Functionality

### How to Import

1. Click **"üì• Import Template"** on the main page
2. Choose import method:
   - **Upload File**: Select a `.tsx` file from your computer
   - **Paste TSX**: Paste TSX code directly

3. The template will be compiled and added to your templates

### Supported Import Formats

#### TSX Files
- Exported templates from the app
- Hand-written templates following the structure
- LLM-generated templates

#### JSON Files (Legacy)
- Templates exported using the JSON export option
- Older template format (still supported)

### Import Requirements

Templates must:
1. Use only these components (pre-imported):
   - `React`
   - `Document` 
   - `Page`

2. Follow this structure:
   ```tsx
   const Template = () => {
     return (
       <Document title="..." type="..." paperSize="...">
         <Page background="..." padding="...">
           {/* Content */}
         </Page>
       </Document>
     );
   };
   ```

3. Use inline styles only (no CSS files)

### Security

The import process includes:
- **Code Validation**: Checks for dangerous patterns
- **Sandboxed Execution**: Uses Babel to compile safely
- **Structure Verification**: Ensures proper template format

Blocked patterns:
- `eval()`, `Function()`
- External imports (except allowed components)
- `window`, `document`, `process` access
- File system operations

## LLM Integration

### Generating Templates with AI

1. Click **"ü§ñ Generate with AI"** on the main page
2. Describe your template requirements
3. Review and edit the generated code
4. Import the template

### LLM Prompt Format

The system provides structured prompts to ensure consistent output:

```typescript
Create a React component for a document template with the following requirements:

[Your description]

Important guidelines:
1. Use ONLY these imports (already available): React, Document, Page
2. Component must be named "Template"
3. Use inline styles as React style objects
4. Available paper sizes: A3, A4, A5, Letter, Legal, Tabloid
```

### Integration Example

```typescript
// In your LLM service
async function generateTemplate(description: string) {
  const prompt = createTemplatePrompt(description);
  const response = await yourLLMAPI.generate(prompt);
  return response.code;
}
```

## Babel Compilation System

### How It Works

1. **TSX ‚Üí JavaScript**: Babel transforms TypeScript/JSX to JavaScript
2. **Safe Execution**: Code runs in controlled environment
3. **Component Creation**: Returns live React component

### Compilation Context

Available in all templates:
```javascript
{
  React,      // React library
  Document,   // Document component
  Page        // Page component
}
```

### Error Handling

Common errors and solutions:

| Error | Cause | Solution |
|-------|-------|----------|
| `X is not defined` | Missing dependency | Check if external styles/variables are inlined |
| `Invalid template structure` | Wrong format | Ensure Document/Page components are used |
| `Compilation failed` | Syntax error | Check TSX syntax, remove TypeScript types |

## Style Handling

### Inline Styles

Always use React style objects:
```tsx
// ‚úÖ Correct
<div style={{ fontSize: 24, color: '#333' }}>

// ‚ùå Incorrect
<div style="font-size: 24px; color: #333">
```

### External Styles

For templates with style imports:
- Styles are automatically inlined during export
- Supported style files:
  - `cactuceStyles`
  - `outletCatalogStyles`
  - Others create empty placeholders

## Best Practices

### For Manual Templates

1. **Keep it Simple**: Use standard HTML elements
2. **Inline Everything**: No external dependencies
3. **Type Safety**: Remove TypeScript types for import
4. **Consistent Naming**: Always name component `Template`

### For LLM Generation

1. **Clear Descriptions**: Be specific about layout needs
2. **Iterative Refinement**: Edit generated code as needed
3. **Test Imports**: Verify template renders correctly
4. **Save Sources**: Keep original prompts for regeneration

### Example Template

```tsx
const Template = () => {
  return (
    <Document title="Invoice" type="flyer" paperSize="A4">
      <Page background="#ffffff" padding="40px">
        <div style={{ marginBottom: 40 }}>
          <h1 style={{ 
            fontSize: 32, 
            color: '#333', 
            marginBottom: 10 
          }}>
            INVOICE
          </h1>
          <p style={{ fontSize: 14, color: '#666' }}>
            Invoice #: INV-001
          </p>
        </div>
        
        <table style={{ 
          width: '100%', 
          borderCollapse: 'collapse' 
        }}>
          <thead>
            <tr>
              <th style={{ 
                padding: 10, 
                textAlign: 'left',
                borderBottom: '2px solid #333'
              }}>
                Description
              </th>
              <th style={{ 
                padding: 10, 
                textAlign: 'right',
                borderBottom: '2px solid #333'
              }}>
                Amount
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style={{ padding: 10 }}>Service</td>
              <td style={{ padding: 10, textAlign: 'right' }}>
                $100.00
              </td>
            </tr>
          </tbody>
        </table>
      </Page>
    </Document>
  );
};
```

## Troubleshooting

### Import Fails

1. **Check Structure**: Ensure Document and Page components are used
2. **Remove Imports**: All imports should be removed
3. **Fix Syntax**: Ensure valid JSX syntax
4. **Inline Styles**: Convert string styles to objects

### Export Issues

1. **Missing Styles**: Styles will be inlined automatically
2. **Component Name**: Will be renamed to `Template`
3. **File Format**: Exports as `.tsx` for better compatibility

### Performance

- Templates compile in milliseconds
- No server round-trip required
- Cached compilation results
- Minimal bundle size impact

## API Reference

### Export Functions

```typescript
exportTemplateForBabel(
  templateName: string, 
  component?: React.FC
): string | null
```

### Import Functions

```typescript
compileReactTemplate(
  tsxCode: string
): {
  component: React.FC | null;
  error: string | null;
}
```

### Validation

```typescript
validateTemplateCode(
  tsxCode: string
): string | null  // Returns error message or null if valid
```

## Future Enhancements

- Support for more component types
- Custom component libraries
- Template marketplace
- Collaborative editing
- Version history
- Template analytics